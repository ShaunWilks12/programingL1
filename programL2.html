<!doctype html>

<head>
    <title>Game</title>
</head>

<body>
    <canvas id="gameCanvas" width="400" height="400"></canvas>

    <script>
        var canvas, canvasContext;

        window.onload = function() {
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');

            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);

            setInterval(mainloop, 1000 / 50); // frame rate 
        }

        // player variables
        var playerXpos = 0;
        var playerYpos = 0;
        const PLAYER_SIZE = 20;
        var playerXspeed = 2;
        var playerYspeed = 2;

        var enemyXpos = 0;
        var enemyYpos = 0;
        const ENEMY_SIZE = 10;
        var enemyXspeed = 2;
        var enemyYspeed = 2;
        var enemyCounter = 4;
        var totalEnemys = 8;

        const LEFT_KEY = 37;
        const RIGHT_KEY = 39;
        const UP_KEY = 38;
        const DOWN_KEY = 40;

        var leftKeyPressed = false;
        var rightKeyPressed = false;
        var upKeyPressed = false;
        var downKeyPressed = false;

        var startingPos = true;

        var hit = false;

        var obXpos = 140;
        var obYpos = 80;
        var obWidth = 280;
        var obHeight = 40;
        var objectCounter = 0;
        var totalObjects = 4;

        var edgeSpace = 20;

        var setup = true;
        var objects = [];
        var enemys = [];

        function mainloop() { // runs the loop 50 times per second
            colorRect(0, 0, canvas.width, canvas.height, '#4A4847'); // Bg
            colorRect(edgeSpace, edgeSpace, canvas.width - edgeSpace * 2, canvas.height - edgeSpace * 2, 'white');
            colorRect(edgeSpace, edgeSpace, canvas.width - 320, canvas.height - 360, '#3DEE11'); // starting area
            colorRect(obXpos, obYpos, obWidth, obHeight, '#11CCEE'); // object
            colorRect(playerXpos, playerYpos, PLAYER_SIZE, PLAYER_SIZE, 'orange'); // player block
            colorRect(enemyXpos, enemyYpos, ENEMY_SIZE, ENEMY_SIZE, 'red'); // enemy block

            playerMove();
            obDraw();
            
            
            enemyDraw();
            EnemyMove();
            collision();

            
            if (setup) {
                for (i = 0; i < totalObjects; i++) {
                    addObject();
                }
                for (i = 0; i < totalEnemys; i++) {
                    addEnemy();
                }
                setup = false;
            }

            if (startingPos) {
                startPos();
                startingPos = false;
            }
        }


        function obDraw() {
            objects.forEach(function(object, index, array) {
                colorRect(object.obXpos2, object.obYpos2, object.obWidth2, object.OB_HEIGHT, '#11CCEE'); // object
            });
        }

        //        function addObjects() {
        //            for (i = 0; i < totalObjects; i++) {
        //                objectCounter++;
        //
        //                var obWidth2 = Math.floor(Math.random() * (200 - 60) + 140);
        //                var obHeight2 = 40;
        //                var obXpos2 = Math.floor(Math.random() * (canvas.width - obWidth2 - edgeSpace * 2) + edgeSpace);
        //                var obYpos2 = edgeSpace + (obHeight2 * 2) * objectCounter;
        //
        //                var object = {
        //                    obXpos2: obXpos2,
        //                    obWidth2: obWidth2,
        //                    obHeight2: obHeight2,
        //                    obYpos2: obYpos2,
        //                }
        //                objects.push(object);
        //            }

        function addObject() {
            var obWidth2 = Math.floor(Math.random() * (220 - 120) + 120);
            obWidth2 = Math.round(obWidth2 / playerXspeed) * playerXspeed; // this is to ensure it is rounding to a divisible of 5 to stop gaps for collisions
            const OB_HEIGHT = 40;
            var obXpos2 = Math.floor(Math.random() * (canvas.width - obWidth2 - edgeSpace * 2) + edgeSpace);
            var obYpos2 = edgeSpace + (OB_HEIGHT * 2) * objectCounter + 80;

            if (objectCounter == 0) {
                obXpos2 = Math.floor(Math.random() * (canvas.width - obWidth2 - edgeSpace * 2) + edgeSpace);
                obXpos2 = Math.round(obXpos2 / playerXspeed) * playerXspeed; // rounding

            } 
                else {
                obXpos2 = Math.floor(Math.random() * (canvas.width - obWidth2 - edgeSpace * 2) + edgeSpace);
                obXpos2 = Math.round(obXpos2 / playerXspeed) * playerXspeed; // rounding
            }

            objectCounter++;

            var object = {
                obXpos2: obXpos2,
                obWidth2: obWidth2,
                OB_HEIGHT: OB_HEIGHT,
                obYpos2: obYpos2,
            }
            objects.push(object);
        }



        function enemyDraw() {
            enemys.forEach(function(enemy, index, array) {
                colorRect(enemy.enemyXpos, enemy.enemyYpos, enemy.ENEMY_SIZE, enemy.ENEMY_SIZE, 'red'); // enemy block
            });
        }

        function EnemyMove() {
            enemys.forEach(function(enemy,i){
                enemy.enemyXpos += enemy.enemyXspeed;
                if(enemy.enemyXpos + enemy.ENEMY_SIZE > canvas.width - edgeSpace){
                    enemy.enemyXspeed *= -1; 
                } 
                if(enemy.enemyXpos < edgeSpace){
                    enemy.enemyXspeed *= -1; 
                }
//                enemy.enemyXspeed = Math.floor(Math.random()*(5-3) +3);               
                
            });
        }
        var enemyCounter2 = 0;
        function addEnemy(){
           
            enemyCounter++
            enemyCounter2 += 0.5;
            
           
            const ENEMY_SIZE = 10
            var enemyYpos = edgeSpace + (40 * 2) * enemyCounter - 355;
            
            console.log(enemyCounter2%1)
            
            if(enemyCounter2%1 == 0){
                enemyCounter--;
               enemyYpos = edgeSpace + (40 * 2) * enemyCounter + 20 - 355;
//                console.log('second')
            }
            
            var enemyXpos = Math.floor(Math.random() * (canvas.width - ENEMY_SIZE - edgeSpace * 2) + edgeSpace);
                Math.floor(Math.random() * (canvas.width - ENEMY_SIZE - edgeSpace * 2) + edgeSpace);
            var enemyXspeed = Math.floor(Math.random()*(4 - 2 ) + 2);
             var enemy = {
                enemyXpos: enemyXpos,
                enemyYpos: enemyYpos,
                ENEMY_SIZE: ENEMY_SIZE,
                 enemyXspeed:enemyXspeed
            }
            enemys.push(enemy);
//            colorRect(enemyXpos, enemyYpos, ENEMY_SIZE, ENEMY_SIZE, 'red');
        }
        

        function startPos() { //starting postion of the player
            playerXpos = canvas.width - 350;
            playerYpos = canvas.height - 370;
            obXpos = 100;
            obYpos = 20;
//            enemyXpos = 150;
//            enemyYpos = 145;
        }


        function keyPressed(evt) {
            // console.log(evt.keyCode);
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = true;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = true;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = true;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = true;
            }
        }

        function keyReleased(evt) {
            if (evt.keyCode == LEFT_KEY) {
                leftKeyPressed = false;
            }
            if (evt.keyCode == RIGHT_KEY) {
                rightKeyPressed = false;
            }
            if (evt.keyCode == UP_KEY) {
                upKeyPressed = false;
            }
            if (evt.keyCode == DOWN_KEY) {
                downKeyPressed = false;
            }
        }

        function collision() {
            objects.forEach(function(object, i) {
                if (playerXpos + PLAYER_SIZE > object.obXpos2 &&
                    playerXpos < object.obXpos2 + object.obWidth2 &&
                    playerYpos + PLAYER_SIZE > object.obYpos2 &&
                    playerYpos < object.obYpos2 + object.OB_HEIGHT) {

                    if (rightKeyPressed) { // then figures out what you pressed to get he collsion
                        playerXpos -= playerXspeed; // nullifies the move from the playermove func
                    }
                    if (leftKeyPressed) {
                        playerXpos += playerXspeed;
                    }
                    if (upKeyPressed) {
                        playerYpos += playerYspeed;
                    }
                    if (downKeyPressed) {
                        playerYpos -= playerYspeed;
                    }
                }
            });
        }

        function collision() { // collision for the constant object
            if (playerXpos + PLAYER_SIZE > obXpos &&
                playerXpos < obXpos + obWidth &&
                playerYpos + PLAYER_SIZE > obYpos &&
                playerYpos < obYpos + obHeight
            ) { // checks for all sizes overlap
                return true; // func = true if hit 
            } else {
                return false; // func = false if not hitting
            }
        }

        function playerMove() {

            if (leftKeyPressed && playerXpos > PLAYER_SIZE) { // move and not out of screen
                playerXpos -= playerXspeed; // normal move 
                collision(); // run function to check if player overlap / hit
                if (collision()) { // if hit true run this
                    playerXpos += playerXspeed; // move back 1 move to undo overlap 
                }
            }

            if (rightKeyPressed && playerXpos + PLAYER_SIZE < canvas.width - 20) {
                playerXpos += playerXspeed;
                collision();
                if (collision()) {
                    playerXpos -= playerXspeed;
                }
            }

            if (upKeyPressed && playerYpos > 20) {
                playerYpos -= playerYspeed;
                collision();
                if (collision()) {
                    playerYpos += playerYspeed;
                }
            }

            if (downKeyPressed && playerYpos + PLAYER_SIZE < canvas.height - 20) {
                playerYpos += playerYspeed;
                collision();
                if (collision()) {
                    playerYpos -= playerYspeed;
                }
            }
        }

        // func for drawing colored rects on canvas  
        function colorRect(x, y, w, h, c) {
            canvasContext.fillStyle = c;
            canvasContext.fillRect(x, y, w, h);
        }

    </script>
</body>
